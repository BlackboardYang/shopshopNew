import{X as g,A as h,S as f,z as n,l as m,Y as c}from"./index-1ff8a101.js";const w=g("user",()=>{const e=h({});return f(()=>Object.keys(e.value).length>0),{userInfo:e,getUserInfo:async({username:s,password:t,rememberme:r})=>{const l=await d({username:s,password:t,rememberme:r});console.log("userStore res",l),e.value=l,console.log("userInfo.value ",e.value),n.success("Login Success!"),await m.replace({path:"/"})},clearUserInfo:()=>{e.value={}}}},{persist:!0}),i=()=>n.error("I have a bad feeling about this..."),p=e=>n.warning(e);function S(e,a,o,s=p,t=i){c.post(e,a,{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(({data:r})=>{r.success?o(r.message,r.status):s(r.message,r.status)}).catch(t)}function y(e,a,o=p,s=i){c.get(e,{withCredentials:!0}).then(({data:t})=>{t.success?a(t.message,t.status):o(t.message,t.status)}).catch(s)}const u=c.create({baseURL:"http://localhost:8081",timeout:5e3});u.interceptors.request.use(e=>{const o=w().userInfo.token;return o&&(e.headers.Authorization=`Bearer ${o}`),e},e=>Promise.reject(e));u.interceptors.response.use(e=>e.data,e=>(n({type:"warning",message:e.response.data.message}),Promise.reject(e)));const d=({username:e,password:a,rememberme:o})=>u({url:"/api/auth/login",method:"POST",data:{username:e,password:a,rememberme:o},headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0,responseType:"json"}).then(s=>{console.log("api response "+JSON.stringify(s)),console.log("api response.data "+s.message);const t=s.message,r=s.status;if(r===200)return console.log("api status "+r),console.log("api data "+t),t;throw n.error("Check your username and password"),new Error("fail")}).catch(s=>{throw console.log(s),new Error("error")});export{y as g,u as h,S as p,w as u};
